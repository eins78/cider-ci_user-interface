-#  Copyright (C) 2013, 2014 Dr. Thomas Schank  (DrTom@schank.ch, Thomas.Schank@algocon.ch)
-#  Licensed under the terms of the GNU Affero General Public License v3.
-#  See the LICENSE.txt file provided with this software.

- trial ||= @trial 
- cache [trial.cache_signature,trial.trial_attachments.collection_cache_tag] do

  %ol.breadcrumb 
    =render '/breadcrumbs/trial', trial: trial
    %li.pull-right 
      %ul.list-inline.list-unstyled
        %li 
          = link_to attachments_workspace_trial_path(trial) do
            Attachments

  %h1 
    Trial for the task "#{trial.task.data['name']}"



  %ul.list-inline
    %li{class: "label #{label_class_for_state(trial.state)}"}
      %i{class: icon_class_for_state(trial.state)}
      =trial.state
    %li.actions.pull-right
      - if admin?
        %ul.list-inline
          %li 
            = form_tag workspace_trial_path(trial), method: 'DELETE' do
              = hidden_field_tag :authenticity_token, form_authenticity_token
              = button_tag type: :submit, class: "btn btn-sm btn-danger" do
                %i.icon-trash
                Delete
          %li 
            = form_tag set_failed_workspace_trial_path(trial), method: 'POST' do
              = hidden_field_tag :authenticity_token, form_authenticity_token
              = button_tag type: :submit, class: "btn btn-sm btn-danger" do
                %i.icon-failed
                Mark as failed
  %p
    Executed 
    -if trial.started_at
      %b #{render 'humanized_time_from_now', at: trial.started_at}
    - if trial.finished_at and trial.started_at
      in 
      %b #{distance_of_time_in_words(trial.started_at,trial.finished_at,include_seconds: true)} 
      (#{(trial.finished_at - trial.started_at).round(2)} seconds)
    - if executor_name = trial.executor.try(:name)
      on 
      %b #{executor_name}.

  -unless trial.error.blank?
    %h3 Execution Error
    %pre
      %code= trial.error


  .scripts
    - if trial.scripts.blank?

      .panel.panel-warning
        .panel-heading
          %h2 Scripts missing
        .panel-body
          %p This trial does not have any scripts associated with it.

          %p 
            They might have been erased afer some period of time in order to save space. 
            Administrators can adjust the retention time.

    - else
      %h2 Scripts 
      %ul.list-inline 
        = render partial: 'script_label', collection: trial.scripts, as: :script

      %ul.list-unstyled.scripts
        = render partial: 'script', collection: trial.scripts
